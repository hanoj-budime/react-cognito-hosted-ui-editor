<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>AWS Cognito Hosted UI URL Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 UMD -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        .dark-mode .glass-card {
            background: rgba(30, 30, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        
        .dark-mode .input-field {
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .input-field:focus {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
        }
        
        .scope-chip {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .scope-chip:hover {
            transform: scale(1.05);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .sticky-header {
            background: rgba(26, 26, 46, 0.95);
        }
        
        .sticky-footer {
            position: sticky;
            bottom: 0;
            z-index: 50;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .sticky-footer {
            background: rgba(26, 26, 46, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /**
         * @typedef {{
         *  response_type: 'code' | 'token';
         *  client_id: string;
         *  redirect_uri: string;
         *  scope: string[];
         *  identity_provider: string;
         * }} CognitoParams
         */

        const SCOPE_OPTIONS = [
            "openid",
            "email",
            "phone",
            "profile",
            "aws.cognito.signin.user.admin",
        ];

        function App() {
            const [darkMode, setDarkMode] = useState(false);
            const [rawUrl, setRawUrl] = useState("");
            const [baseUrl, setBaseUrl] = useState("");

            /** @type {[CognitoParams, Function]} */
            const [params, setParams] = useState({
                response_type: "code",
                client_id: "",
                redirect_uri: "",
                scope: [],
                identity_provider: "",
            });

            const [generatedUrl, setGeneratedUrl] = useState("");
            const [copyStatus, setCopyStatus] = useState("Copy");

            useEffect(() => {
                document.body.className = darkMode ? "dark-mode min-h-screen" : "min-h-screen";
            }, [darkMode]);

            /** Parse pasted Hosted UI URL */
            function parseUrl(url) {
                try {
                    const u = new URL(url);
                    setBaseUrl(u.origin + u.pathname);

                    const scope = u.searchParams.get("scope");
                    setParams({
                        response_type: u.searchParams.get("response_type") || "code",
                        client_id: u.searchParams.get("client_id") || "",
                        redirect_uri: u.searchParams.get("redirect_uri") || "",
                        scope: scope ? scope.split(/[ +]/) : [],
                        identity_provider: u.searchParams.get("identity_provider") || "",
                    });
                } catch (e) {
                    // Silently fail if URL is partial/invalid during typing
                }
            }

            /** Generate final Hosted UI URL */
            function generateUrl() {
                if (!baseUrl || !params.client_id || !params.redirect_uri) {
                    alert("Please fill in the required fields: Base URL, Client ID, and Redirect URI.");
                    return;
                }

                try {
                    const url = new URL(baseUrl.includes("?") ? baseUrl.split("?")[0] : baseUrl);
                    url.searchParams.set("response_type", params.response_type);
                    url.searchParams.set("client_id", params.client_id);
                    url.searchParams.set("redirect_uri", params.redirect_uri);

                    if (params.scope.length > 0) {
                        // Use spaces and let URLSearchParams encode, then convert %20 to +
                        url.searchParams.set("scope", params.scope.join(" "));
                    }

                    if (params.identity_provider) {
                        url.searchParams.set("identity_provider", params.identity_provider);
                    }

                    // Convert %20 to + for Cognito standard
                    const finalUrl = url.toString().replace(/%20/g, "+");
                    setGeneratedUrl(finalUrl);
                } catch (e) {
                    alert("Invalid Base URL format.");
                }
            }

            function toggleScope(scope) {
                setParams((p) => ({
                    ...p,
                    scope: p.scope.includes(scope)
                        ? p.scope.filter((s) => s !== scope)
                        : [...p.scope, scope],
                }));
            }

            const copyToClipboard = () => {
                navigator.clipboard.writeText(generatedUrl);
                setCopyStatus("‚úì Copied!");
                setTimeout(() => setCopyStatus("Copy"), 2000);
            };

            return (
                <div>
                    {/* Header with Dark Mode Toggle */}
                    <div class="sticky-header py-2 px-4">
                        <div class="max-w-5xl mx-auto">
                            <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">
                                    <img src="favicon.svg" alt="cognito-logo" class="h-10 w-10" />
                                </div>
                                <div>
                                    <h1 class={`text-lg sm:text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                                        AWS Cognito Hosted UI
                                    </h1>
                                    <p class={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                        Parse, edit, and generate authorization URLs
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={() => setDarkMode(!darkMode)}
                                class={`p-2 rounded-lg transition-all ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'}`}
                                title="Toggle dark mode"
                            >
                                <span class="text-xl">{darkMode ? '‚òÄÔ∏è' : 'üåô'}</span>
                            </button>
                        </div>
                        </div>
                    </div>

                    <div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
                        {/* URL Input Section */}
                        <div class="glass-card rounded-2xl p-6 mb-6 fade-in">
                        <label class={`block font-semibold mb-3 flex items-center gap-2 ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                            <span class="text-xl">üìã</span>
                            Paste Hosted UI URL
                        </label>
                        <textarea
                            class={`w-full p-4 rounded-xl input-field font-mono text-sm ${darkMode ? 'bg-gray-800 text-gray-200' : 'bg-gray-50 text-gray-900'}`}
                            rows="3"
                            placeholder="https://your-domain.auth.region.amazoncognito.com/login?..."
                            value={rawUrl}
                            onChange={(e) => {
                                setRawUrl(e.target.value);
                                parseUrl(e.target.value);
                            }}
                        />
                    </div>

                    {/* Configuration Form */}
                    <div class="glass-card rounded-2xl p-6 mb-6 fade-in">
                        <h2 class={`text-xl font-bold mb-6 flex items-center gap-2 ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                            <span class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-full h-8 w-8 flex items-center justify-center text-sm">1</span>
                            Configuration Parameters
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* response_type */}
                            <div>
                                <label class={`block font-semibold mb-2 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    Response Type *
                                </label>
                                <select
                                    class={`w-full p-3 rounded-xl input-field ${darkMode ? 'bg-gray-800 text-gray-200' : 'bg-gray-50 text-gray-900'}`}
                                    value={params.response_type}
                                    onChange={(e) =>
                                        setParams({ ...params, response_type: e.target.value })
                                    }
                                >
                                    <option value="code">code (Authorization Code Grant)</option>
                                    <option value="token">token (Implicit Grant)</option>
                                </select>
                            </div>

                            {/* client_id */}
                            <div>
                                <label class={`block font-semibold mb-2 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    Client ID *
                                </label>
                                <input
                                    class={`w-full p-3 rounded-xl input-field font-mono ${darkMode ? 'bg-gray-800 text-gray-200' : 'bg-gray-50 text-gray-900'}`}
                                    placeholder="Enter App Client ID"
                                    value={params.client_id}
                                    onChange={(e) =>
                                        /^[a-zA-Z0-9]*$/.test(e.target.value) &&
                                        setParams({ ...params, client_id: e.target.value })
                                    }
                                />
                            </div>

                            {/* redirect_uri */}
                            <div class="md:col-span-2">
                                <div class="flex justify-between items-center mb-2">
                                    <label class={`block font-semibold text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                        Redirect URI *
                                    </label>
                                    <button
                                        class={`text-xs font-medium px-3 py-1 rounded-lg transition-colors ${darkMode ? 'text-purple-400 hover:bg-gray-800' : 'text-purple-600 hover:bg-purple-50'}`}
                                        onClick={() =>
                                            setParams({
                                                ...params,
                                                redirect_uri: "https://oidcdebugger.com/debug",
                                            })
                                        }
                                    >
                                        Use OIDC Debugger
                                    </button>
                                </div>
                                <input
                                    class={`w-full p-3 rounded-xl input-field ${darkMode ? 'bg-gray-800 text-gray-200' : 'bg-gray-50 text-gray-900'}`}
                                    placeholder="https://example.com/callback"
                                    value={params.redirect_uri}
                                    onChange={(e) =>
                                        setParams({ ...params, redirect_uri: e.target.value })
                                    }
                                />
                            </div>

                            {/* scope */}
                            <div class="md:col-span-2">
                                <label class={`block font-semibold mb-3 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    Scopes
                                </label>
                                <div class="flex flex-wrap gap-2">
                                    {SCOPE_OPTIONS.map((s) => (
                                        <button
                                            key={s}
                                            onClick={() => toggleScope(s)}
                                            class={`scope-chip px-4 py-2 rounded-full text-sm font-medium border-2 ${
                                                params.scope.includes(s)
                                                    ? 'bg-gradient-to-r from-purple-500 to-indigo-500 text-white border-transparent shadow-lg'
                                                    : darkMode 
                                                        ? 'bg-gray-800 text-gray-300 border-gray-700 hover:border-gray-600'
                                                        : 'bg-white text-gray-700 border-gray-300 hover:border-gray-400'
                                            }`}
                                        >
                                            {s}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* identity_provider */}
                            <div class="md:col-span-2">
                                <label class={`block font-semibold mb-2 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    Identity Provider (Optional)
                                </label>
                                <input
                                    class={`w-full p-3 rounded-xl input-field ${darkMode ? 'bg-gray-800 text-gray-200' : 'bg-gray-50 text-gray-900'}`}
                                    placeholder="e.g., Google, SAML, LoginWithAmazon"
                                    value={params.identity_provider}
                                    onChange={(e) =>
                                        setParams({
                                            ...params,
                                            identity_provider: e.target.value,
                                        })
                                    }
                                />
                            </div>
                        </div>

                        {/* Generate Button */}
                        <button
                            class="w-full mt-8 btn-primary text-white font-bold py-4 px-6 rounded-xl shadow-lg"
                            onClick={generateUrl}
                        >
                            Generate Hosted UI URL
                        </button>
                    </div>

                    {/* Output Section */}
                    {generatedUrl && (
                        <div class="glass-card rounded-2xl p-6 fade-in">
                            <label class={`block font-bold mb-4 text-lg flex items-center gap-2 ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                                <span class="text-xl">‚ú®</span>
                                Generated URL
                            </label>
                            <textarea
                                class={`w-full p-4 rounded-xl font-mono text-sm mb-4 ${
                                    darkMode 
                                        ? 'bg-gray-900 text-green-400 border-2 border-gray-700' 
                                        : 'bg-gray-900 text-green-400 border-2 border-gray-300'
                                }`}
                                rows="4"
                                readOnly
                                value={generatedUrl}
                            />
                            <div class="flex flex-wrap gap-3">
                                <button
                                    class={`flex-1 py-3 px-6 rounded-xl font-medium transition-all ${
                                        darkMode 
                                            ? 'bg-gray-700 hover:bg-gray-600 text-white' 
                                            : 'bg-gray-200 hover:bg-gray-300 text-gray-900'
                                    }`}
                                    onClick={copyToClipboard}
                                >
                                    {copyStatus}
                                </button>
                                <button
                                    class="flex-1 btn-primary text-white py-3 px-6 rounded-xl font-medium shadow-lg"
                                    onClick={() => window.open(generatedUrl, "_blank")}
                                >
                                    Open in New Tab
                                </button>
                            </div>
                        </div>
                    )}
                    </div>

                    {/* Footer */}
                    <footer class="sticky-footer py-2 px-4">
                        <div class={`max-w-5xl mx-auto text-center text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                        <p class="mb-1">Developed by Hanoj Budime ¬∑ 2025-2026</p>
                        <div class="flex justify-center gap-3 flex-wrap">
                            <a 
                                href="https://github.com/hanoj-budime/react-cognito-hosted-ui/issues" 
                                target="_blank"
                                class={`hover:underline ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}
                            >
                                Report Issue on GitHub
                            </a>
                            <a 
                                href="https://www.linkedin.com/in/hanoj-budime" 
                                target="_blank"
                                class={`hover:underline ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}
                            >
                                Connect on LinkedIn
                            </a>
                            <a 
                                href="https://github.com/hanoj-budime" 
                                target="_blank"
                                class={`hover:underline ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}
                            >
                                View GitHub Profile
                            </a>
                        </div>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
</body>

</html>